// src/app/api/init-db/route.ts
// ‚ö†Ô∏è SUPPRIMER CETTE ROUTE APR√àS UTILISATION
import { NextResponse } from 'next/server'
import { prisma } from '@/lib/db'
import bcrypt from 'bcryptjs'

export async function POST(request: Request) {
  try {
    const { secret } = await request.json()
    
    // Protection basique
    if (secret !== 'votre-secret-temporaire-12345') {
      return NextResponse.json({ message: 'Non autoris√©' }, { status: 401 })
    }
    
    // Hasher le mot de passe
    const hashedPassword = await bcrypt.hash('Demo2024!', 10)
    
    // Cr√©er l'utilisateur
    const user = await prisma.user.upsert({
      where: { email: 'marie.dubois@agence.com' },
      update: {},
      create: {
        email: 'marie.dubois@agence.com',
        firstName: 'Marie',
        lastName: 'Dubois',
        password: hashedPassword,
        role: 'AGENCY',
        emailVerified: new Date(),
      },
    })
    
    // Cr√©er les cat√©gories
    const categories = [
      { name: 'Mobilier', colorHex: '#3B82F6', icon: 'ü™ë' },
      { name: 'Luminaire', colorHex: '#10B981', icon: 'üí°' },
      { name: 'D√©coration', colorHex: '#F59E0B', icon: 'üñºÔ∏è' },
      { name: 'Rev√™tement', colorHex: '#8B5CF6', icon: 'üé®' },
      { name: '√âquipement', colorHex: '#EF4444', icon: 'üîß' },
    ]
    
    for (const cat of categories) {
      await prisma.prescriptionCategory.upsert({
        where: { name: cat.name },
        update: {},
        create: cat,
      })
    }
    
    return NextResponse.json({ 
      message: 'Base de donn√©es initialis√©e avec succ√®s! Utilisateur: marie.dubois@agence.com / Mot de passe: Demo2024!'
    })
  } catch (error) {
    console.error('Erreur init DB:', error)
    return NextResponse.json(
      { message: 'Erreur lors de l\'initialisation' },
      { status: 500 }
    )
  }
}